async function fetchBanList(){try{const a=await fetch("https://7011k.github.io/creatingpixelart/BANList.text");if(!a.ok)return[];const b=await a.text();return b.split("\n").map(a=>a.trim().toLowerCase()).filter(a=>a)}catch(a){return[]}}export function blendColors(a,b,c,d){return d||0!==b[3]?[Math.round(a[0]*c+b[0]*(1-c)),Math.round(a[1]*c+b[1]*(1-c)),Math.round(a[2]*c+b[2]*(1-c)),Math.round(a[3]*c+b[3]*(1-c))]:b}export function getImageDataFromImg(a,b,c){const d=document.createElement("canvas");d.width=b,d.height=c;const e=d.getContext("2d");return e.drawImage(a,0,0,b,c),e.getImageData(0,0,b,c)}export async function generatePixelArt(a,b,c,d,e,f){function g(a,b,f){for(let g=a;g<Math.min(j,a+b);g++){for(let a=0;a<i;a++){const b=4*(g*i+a),e=[m[b],m[b+1],m[b+2],m[b+3]];if(0===e[3])continue;const f=p[v],h=f.data;for(let b=0;b<o;b++)for(let f=0;f<n;f++){const i=4*(b*n+f),j=[h[i],h[i+1],h[i+2],h[i+3]];if(!d&&0===j[3])continue;const k=blendColors(e,j,c,d),l=a*n+f,m=g*o+b,p=4*(m*q+l);u.data[p]=k[0],u.data[p+1]=k[1],u.data[p+2]=k[2],u.data[p+3]=k[3]}v=(v+1)%p.length}w++,"function"==typeof e&&0==g%10&&e(Math.round(100*(w/j)))}a+b<j?setTimeout(()=>g(a+b,b,f),0):(t.putImageData(u,0,0),f(s))}if(!f||""===f.trim())throw new Error("Google\u30ED\u30B0\u30A4\u30F3\u3057\u3066\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u53D6\u5F97\u3057\u3066\u304F\u3060\u3055\u3044");const h=await fetchBanList();if(h.includes(f.toLowerCase()))throw new Error("\u3053\u306E\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u306F\u5229\u7528\u3067\u304D\u307E\u305B\u3093\uFF08BAN\u30EA\u30B9\u30C8\u4E00\u81F4\uFF09");let i=Math.min(a.width,500),j=Math.min(a.height,500);const k=document.createElement("canvas");k.width=i,k.height=j;const l=k.getContext("2d");l.drawImage(a,0,0,i,j);const m=l.getImageData(0,0,i,j).data;let n=Math.min(b[0].width,50),o=Math.min(b[0].height,50);const p=[];for(let g=0;g<b.length;g++)p.push(getImageDataFromImg(b[g],n,o));const q=i*n,r=j*o;if(25e3<q||25e3<r)throw new Error("\u51FA\u529B\u753B\u50CF\u30B5\u30A4\u30BA\u304C\u5927\u304D\u3059\u304E\u307E\u3059");const s=document.createElement("canvas");s.width=q,s.height=r;const t=s.getContext("2d");let u=t.createImageData(q,r),v=0,w=0;return new Promise((a,b)=>{try{g(0,10,a)}catch(a){b(a)}})}
