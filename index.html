<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    .container { max-width: 700px; margin: auto; }
    .progress { width: 100%; background: #eee; border-radius: 3px; }
    .bar { background: #4caf50; height: 16px; border-radius: 3px; width: 0%; }
    .file-list { font-size: 0.9em; color: #555; margin-bottom: 1em; }
    .preview-area { margin-top: 1em; }
    #previewImage { border:1px solid #ccc; max-width:400px; max-height:400px; display:block; }
    .button-row { margin-bottom: 1em; }
    .locked { pointer-events: none; opacity: 0.5; }
    #loginStatus { color: #d32f2f; margin-bottom: 1em; }

    /* ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
    #customDialog {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid #ccc;
      padding: 1em;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    #customDialog h2 {
      margin-top: 0;
      font-size: 1.2em;
    }
    #customDialog button {
      margin-top: 1em;
    }
    #dialogContent {
      white-space: pre-wrap;
      margin-bottom: 1em;
    }
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<div id="loginStatus">Googleãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</div>
<div id="googleSignInBtn"></div>
<div class="container locked" id="mainContainer">
  <h1>ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«</h1>
  <div class="button-row">
    <button id="infoBtn">èª¬æ˜ã‚’è¡¨ç¤º</button>
    <button id="termsBtn">åˆ©ç”¨è¦ç´„</button>
  </div>

  <label>ãƒ–ãƒ¬ãƒ³ãƒ‰ç‡ (0.0ï½1.0):</label><br>
  <input id="blendRatio" type="range" min="0" max="1" step="0.01" value="0.5" style="width:300px;">
  <span id="blendRatioVal">0.5</span>
  <br><br>

  <label>
    <input id="mixBackground" type="checkbox">
    èƒŒæ™¯ï¼ˆRGBA=(0, 0, 0, 0)ï¼‰ã‚’ãƒŸãƒƒã‚¯ã‚¹å¯¾è±¡ã«ã™ã‚‹
  </label><br>
  <label>
    <input id="useFolder" type="checkbox">
    ç´ æç”»åƒã‚’ãƒ•ã‚©ãƒ«ãƒ€å†…ç”»åƒå…¨ã¦å¯¾è±¡ã«ã™ã‚‹
  </label><br><br>

  <label>å…ƒç”»åƒã‚’é¸æŠï¼ˆæœ€å¤§500Ã—500ï¼‰: 
    <input id="baseImage" type="file" accept="image/*">
  </label>
  <div class="file-list" id="baseFileName"></div>
  <div id="materialInput">
    <label>ç´ æç”»åƒã‚’é¸æŠï¼ˆæœ€å¤§50Ã—50ï¼‰: 
      <input id="materialImage" type="file" accept="image/*">
    </label>
    <div class="file-list" id="materialFileName"></div>
  </div>
  <div id="materialFolderInput" style="display:none;">
    <label>ç´ æç”»åƒãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ: 
      <input id="materialFolder" type="file" accept="image/*" multiple>
    </label>
    <div class="file-list" id="materialFolderFileNames"></div>
  </div>
  <br>

  <button id="generateBtn">ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆã‚’ç”Ÿæˆ</button><br>
  <div class="progress" id="progressBar" style="display:none;"><div class="bar" id="progressBarBar"></div></div>
  <a id="downloadLink" style="display:none;" download="output_image.png">ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
  <br>
  <div class="preview-area">
    <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
    <img id="previewImage" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ" style="display:none;">
  </div>
</div>

<!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<div id="customDialog">
  <h2 id="dialogTitle">ğŸ“Œ ã‚¿ã‚¤ãƒˆãƒ«</h2>
  <div id="dialogContent">ã“ã“ã«æœ¬æ–‡ãŒå…¥ã‚Šã¾ã™ã€‚</div>
  <button onclick="closeDialog()">OK</button>
</div>

<script type="module">
import { setupGoogleLogin, userEmail } from './auth.js';
import { blendColors, getImageDataFromImg, generatePixelArt } from './pixelart.js';

document.getElementById('blendRatio').addEventListener('input', function() {
  document.getElementById('blendRatioVal').textContent = this.value;
});
document.getElementById('useFolder').addEventListener('change', function() {
  const useFolder = document.getElementById('useFolder').checked;
  document.getElementById('materialInput').style.display = useFolder ? 'none' : '';
  document.getElementById('materialFolderInput').style.display = useFolder ? '' : 'none';
});
document.getElementById('baseImage').addEventListener('change', () => showFileName('baseImage', 'baseFileName'));
document.getElementById('materialImage').addEventListener('change', () => showFileName('materialImage', 'materialFileName'));
document.getElementById('materialFolder').addEventListener('change', () => showFileName('materialFolder', 'materialFolderFileNames'));

function showFileName(inputId, labelId) {
  const input = document.getElementById(inputId);
  const label = document.getElementById(labelId);
  if (input.files.length === 0) {
    label.textContent = '';
  } else if (input.files.length === 1) {
    label.textContent = `é¸æŠãƒ•ã‚¡ã‚¤ãƒ«: ${input.files[0].name}`;
  } else {
    label.textContent = `é¸æŠãƒ•ã‚¡ã‚¤ãƒ«æ•°: ${input.files.length}`;
    let names = '';
    for (let i = 0; i < input.files.length; i++) {
      names += input.files[i].name + ', ';
    }
    label.textContent += ' (' + names.slice(0,-2) + ')';
  }
}

// ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
function showDialog(title, content) {
  document.getElementById('dialogTitle').textContent = title;
  document.getElementById('dialogContent').textContent = content;
  document.getElementById('customDialog').style.display = 'block';
}
function closeDialog() {
  document.getElementById('customDialog').style.display = 'none';
}
document.getElementById('infoBtn').onclick = () => {
  showDialog('ğŸ“Œ ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦', `æœ¬ã‚¢ãƒ—ãƒªã¯é¸æŠã—ãŸå…ƒç”»åƒã®è‰²ã‚’è§£æã—ç´ æç”»åƒã‚’å¤‰æ›´ã—ã¦ä¸¦ã¹ã‚‹ã“ã¨ã§ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ãƒ»å…ƒç”»åƒã¯æœ€å¤§500Ã—500ã€ç´ æç”»åƒã¯æœ€å¤§50Ã—50ãƒ”ã‚¯ã‚»ãƒ«ã¾ã§ã§ã™
ãƒ»GitHub Pagesã§å…¬é–‹ã—ã¦ã‚‚ã€é¸æŠã—ãŸç”»åƒã¯PCã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã€å¤–éƒ¨é€ä¿¡ã•ã‚Œã¾ã›ã‚“
ãƒ»ç´ æç”»åƒã‚µã‚¤ã‚ºã¯æ­£æ–¹å½¢æ¨å¥¨ã§ã™
ãƒ»è¤‡æ•°ç´ æç”»åƒã‚’ä½¿ã†å ´åˆã¯ã€ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„

ç”Ÿæˆå¾Œã€ã€Œç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒªãƒ³ã‚¯ã‹ã‚‰ä¿å­˜ã§ãã¾ã™ã€‚
ç”Ÿæˆç”»åƒã¯ä¸‹éƒ¨ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆå¤§ãã„ç”»åƒã¯ç¸®å°è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰ã€‚`);
};
document.getElementById('termsBtn').onclick = () => {
  showDialog('ğŸ“œ åˆ©ç”¨è¦ç´„', `ã“ã‚Œã‚‰ãŒå®ˆã‚‰ã‚Œã¦ã„ãªã„å ´åˆè£½ä½œè€…ã«ã‚ˆã‚‹åˆ©ç”¨åœæ­¢æªç½®ã‚’è¡Œã„ã¾ã™ã®ã§ã”æ³¨æ„ä¸‹ã•ã„ã€‚

ãƒ»ã‚³ãƒ¼ãƒ‰ã®è§£æã‚„ã‚¢ãƒ—ãƒªã‚’ä½¿ã£ãŸæœ‰æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½œæˆã¯ç¦æ­¢ã§ã™
ãƒ»æœ¬ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã—ã¦ç”Ÿæˆã—ãŸç”»åƒã®è‘—ä½œæ¨©ã¯ä½¿ç”¨ã—ãŸç”»åƒã®è£½ä½œè€…ã«ä¾å­˜ã—ã¾ã™
ãƒ»ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®è²©å£²ã¯ç¦æ­¢ã§ã™
ãƒ»ç”Ÿæˆã•ã‚ŒãŸç”»åƒã¯SNSã§ã®å…¬é–‹ã€ã‚¢ã‚¤ã‚³ãƒ³ã§ã®ä½¿ç”¨ã®ã¿è¨±å¯ã—ã¾ã™ã€€
ã€€â€»ç”»åƒå…¬é–‹ã®éš›ã¯æœ¬ã‚¢ãƒ—ãƒªã®URLã‚’ä¹—ã›ã¦ãã ã•ã„
ãƒ»ç”Ÿæˆã•ã‚ŒãŸç”»åƒã«é–¢ã—ã¦ã®ãƒˆãƒ©ãƒ–ãƒ«ã«ã¯ä¸€åˆ‡ã‹ã‹ã‚ã‚Šã¾ã›ã‚“ã®ã§ã”æ³¨æ„ãã ã•ã„`);
};

// Googleèªè¨¼
setup
